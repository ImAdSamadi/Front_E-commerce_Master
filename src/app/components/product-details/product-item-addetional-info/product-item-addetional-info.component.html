<!-- Review Images Modal -->
<div
  class="modal fade"
  id="reviewImagesModal"
  tabindex="-1"
  aria-labelledby="reviewImagesModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reviewImagesModalLabel">
          {{ currentReviewerName }} <small class="text-muted">{{ currentReviewText }}</small>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <div
          id="review-carousel"
          class="carousel slide bg-light"
          data-ride="carousel"
          style="max-height: 500px;"
        >
          <div class="carousel-inner">
            <div
              class="carousel-item"
              *ngFor="let img of currentReviewImages; let i = index"
              style="height: 500px;"
            >
            <img
                [src]="img"
                alt="Review Image"
                class="w-100 h-100"
                style="object-fit: contain;"
              />
            </div>
          </div>

          <a class="carousel-control-prev" href="#review-carousel" role="button" data-slide="prev" style="width: 50px;">
            <i class="fa fa-2x fa-angle-left text-dark"></i>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#review-carousel" role="button" data-slide="next" style="width: 50px;">
            <i class="fa fa-2x fa-angle-right text-dark"></i>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>



<!-- ✅ Custom Alert Modal -->
<div class="modal"
     id="alertModal"
     role="dialog"
     aria-labelledby="alertModalLabel"
     aria-hidden="true"
     [class.show]="showModal"
     [ngStyle]="{ display: showModal ? 'block' : 'none' }"
     style="background: rgba(0,0,0,0.6); z-index: 1050;">
  <div class="modal-dialog" role="document">
    <div [ngClass]="{
          'modal-content bg-success': alertType === 0,
          'modal-content bg-warning': alertType === 1,
          'modal-content bg-danger': alertType === 2
        }">
      <div class="modal-header text-center">
        <h5
          class="modal-title"
          id="alertModalLabel"
          [ngClass]="{ 'text-white': alertType != 1 }"
        >
          <strong>
            {{ alertType === 0 ? 'SUCCESS' : alertType === 1 ? 'WARNING' : 'ERROR' }}
          </strong>
        </h5>
        <button type="button" class="close" aria-label="Close" (click)="closeModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <h6
          class="modal-title"
          [ngClass]="{ 'text-white': alertType != 1 }"
        >
          <strong>{{ alertMessage }}</strong>
        </h6>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-dark" (click)="closeModal()">Close</button>
      </div>
    </div>
  </div>
</div>



<!-- 🗑️ Confirm Delete Modal -->
<div class="modal fade"
     id="confirmDeleteModal"
     tabindex="-1"
     role="dialog"
     aria-labelledby="confirmModalLabel"
     aria-hidden="true"
     [class.show]="showConfirmModal"
     [ngStyle]="{ display: showConfirmModal ? 'block' : 'none' }"
     style="background: rgba(0,0,0,0.6);">
  <div class="modal-dialog" role="document">
    <div class="modal-content bg-danger text-white">
      <div class="modal-header">
        <h5 class="modal-title text-white" id="confirmModalLabel">Product Created</h5>
        <button type="button" class="close text-white" aria-label="Close" (click)="closeConfirmModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <strong>Are you sure you want to delete this Review ?</strong>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="closeConfirmModal()">Cancel</button>
        <button type="button" class="btn btn-dark" (click)="deleteConfirmedReview()">Delete</button>
      </div>
    </div>
  </div>
</div>



<div class="row px-xl-5">
  <div class="col">
    <div class="bg-light p-30">
      <div class="nav nav-tabs mb-4">
        <a class="nav-item nav-link text-dark active" data-toggle="tab" href="#tab-pane-1">Description</a>
        <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Information</a>
        <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-3">Reviews ({{totalElements}})</a>
      </div>
      <div class="tab-content">
        <div class="tab-pane fade show active" id="tab-pane-1">
          <h4 class="mb-3">Product Description</h4>
          <p *ngFor="let paragraph of descriptionParagraphs">
            {{ paragraph }}
          </p>
        </div>
        <div class="tab-pane fade" id="tab-pane-2">
          <h4 class="mb-3">Additional Information</h4>
          <p>Eos no lorem eirmod diam diam, eos elitr et gubergren diam sea. Consetetur vero aliquyam invidunt duo dolores et duo sit. Vero diam ea vero et dolore rebum, dolor rebum eirmod consetetur invidunt sed sed et, lorem duo et eos elitr, sadipscing kasd ipsum rebum diam. Dolore diam stet rebum sed tempor kasd eirmod. Takimata kasd ipsum accusam sadipscing, eos dolores sit no ut diam consetetur duo justo est, sit sanctus diam tempor aliquyam eirmod nonumy rebum dolor accusam, ipsum kasd eos consetetur at sit rebum, diam kasd invidunt tempor lorem, ipsum lorem elitr sanctus eirmod takimata dolor ea invidunt.</p>
          <div class="row">
            <div class="col-md-6">
              <ul class="list-group list-group-flush">
                <li class="list-group-item px-0">
                  Sit erat duo lorem duo ea consetetur, et eirmod takimata.
                </li>
                <li class="list-group-item px-0">
                  Amet kasd gubergren sit sanctus et lorem eos sadipscing at.
                </li>
                <li class="list-group-item px-0">
                  Duo amet accusam eirmod nonumy stet et et stet eirmod.
                </li>
                <li class="list-group-item px-0">
                  Takimata ea clita labore amet ipsum erat justo voluptua. Nonumy.
                </li>
              </ul>
            </div>
            <div class="col-md-6">
              <ul class="list-group list-group-flush">
                <li class="list-group-item px-0">
                  Sit erat duo lorem duo ea consetetur, et eirmod takimata.
                </li>
                <li class="list-group-item px-0">
                  Amet kasd gubergren sit sanctus et lorem eos sadipscing at.
                </li>
                <li class="list-group-item px-0">
                  Duo amet accusam eirmod nonumy stet et et stet eirmod.
                </li>
                <li class="list-group-item px-0">
                  Takimata ea clita labore amet ipsum erat justo voluptua. Nonumy.
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="tab-pane-3">
          <div class="row">

            <div class="col-md-6">
              <h4 class="mb-4">{{totalElements}} reviews for {{product?.name}}</h4>
              <div class="media mb-4" *ngFor="let review of reviews">
                <img [src]="review.customerProfileImageBase64" alt="Image" class="img-fluid mr-3 mt-1" style="width: 45px;">
                <div class="media-body">
                  <h6>{{review.customerName}}<small> - <i>{{ review.reviewDate | date: 'dd MMM yyyy' }} </i></small>
                    <!-- ✅ Show delete button only if user is the author -->
                    <button
                      *ngIf="securityService.hasRoleIn(['ADMIN'])"
                      class="btn btn-sm btn-outline-danger"
                      (click)="openDeleteModal(review.reviewId)">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </h6>
                  <div class="text-primary mb-2">
                    <div class="text-primary mb-2">
                      <ng-container *ngFor="let filled of getStarsArray(review.rating)">
                        <i class="fa-star" [ngClass]="filled ? 'fas text-warning' : 'far'"></i>
                      </ng-container>
                    </div>
                  </div>

                  <p style="text-align: justify;">{{ review.reviewText }}</p>

                  <!-- 🖼️ Review Images -->
                  <div class="d-flex flex-wrap mt-2">
                    <!-- Show first 7 normally -->
                    <ng-container *ngFor="let img of review.reviewImagesBase64?.slice(0, 7); let i = index">
                      <img
                        [src]="img"
                        alt="Review Image"
                        class="img-fluid mr-2 mb-2"
                        style="width: 45px; height: 45px; object-fit: cover; border-radius: 4px; cursor: pointer;"
                        (click)="openReviewImagesModal(review.reviewImagesBase64!, i, review.customerName, review.reviewText)"
                      />
                    </ng-container>

                    <!-- 8th slot = 'show more' overlay -->
                    <ng-container *ngIf="review.reviewImagesBase64 && review.reviewImagesBase64.length > 7">
                      <div
                        class="position-relative mr-2 mb-2"
                        style="width: 45px; height: 45px; border-radius: 4px; overflow: hidden; cursor: pointer;"
                        (click)="openReviewImagesModal(review.reviewImagesBase64!, 7, review.customerName, review.reviewText)"
                      >
                        <img
                          [src]="review.reviewImagesBase64[7]"
                          alt="Review Image"
                          class="img-fluid h-100 w-100"
                          style="object-fit: cover; filter: brightness(50%);"
                        />
                        <div
                          class="position-absolute d-flex justify-content-center align-items-center"
                          style="top: 0; left: 0; width: 100%; height: 100%; color: white;"
                        >
                          <i class="fa fa-ellipsis-v fa-lg"></i>
                        </div>
                      </div>
                    </ng-container>

                  </div>


                </div>
              </div>
              <div class="col-12 mt-4">
                <nav *ngIf="totalPages > 1">
                  <ul class="pagination justify-content-center">
                    <!-- Previous Button -->
                    <li class="page-item" [class.disabled]="currentPage === 0">
                      <a class="page-link" href="#" (click)="changePage(currentPage - 1, $event)">&lt;</a>
                    </li>

                    <!-- Page Numbers -->
                    <li class="page-item"
                        *ngFor="let page of [].constructor(totalPages); let i = index"
                        [class.active]="i === currentPage">
                      <a class="page-link" href="#" (click)="changePage(i, $event)">{{ i + 1 }}</a>
                    </li>

                    <!-- Next Button -->
                    <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
                      <a class="page-link" href="#" (click)="changePage(currentPage + 1, $event)">&gt;</a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>

            <div class="col-md-6">
              <h4 class="mb-4">Leave a review</h4>
              <small>Your email address will not be published. Required fields are marked *</small>

              <!-- ⭐ Rating Stars -->
              <div class="d-flex my-3 align-items-center">
                <p class="mb-0 mr-2">Your Rating * :</p>
                <div class="text-primary">
                  <i
                    *ngFor="let star of [1, 2, 3, 4, 5]"
                    class="fa-star"
                    [ngClass]="{
                      'fas text-warning': star <= (newReview.rating || 0),
                      'far': star > (newReview.rating || 0)
                    }"
                    (click)="setRating(star)"
                    style="cursor: pointer; font-size: 1.2rem;"
                  ></i>
                </div>
              </div>

              <!-- 📝 Review Form -->
              <form (ngSubmit)="submitReview(reviewForm)" #reviewForm="ngForm" novalidate>
                <!-- Review Text -->
                <div class="form-group">
                  <label for="message">Your Review *</label>
                  <textarea
                    id="message"
                    cols="30"
                    rows="5"
                    class="form-control"
                    [(ngModel)]="newReview.reviewText"
                    name="reviewText"
                    #reviewText="ngModel"
                    required
                  ></textarea>
                  <div *ngIf="reviewForm.submitted && reviewText.invalid" class="text-danger">
                    Review text is required.
                  </div>
                </div>

                <ng-container *ngIf="!securityService.profile">

                <!-- Name -->
                <div class="form-group">
                  <label for="name">Your Name *</label>
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    [(ngModel)]="newReview.customerName"
                    name="customerName"
                    #customerName="ngModel"
                    required
                  />
                  <div *ngIf="reviewForm.submitted && customerName.invalid" class="text-danger">
                    Name is required.
                  </div>
                </div>

                <!-- Email -->
                <div class="form-group">
                  <label for="email">Your Email *</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    [(ngModel)]="newReview.customerEmail"
                    name="customerEmail"
                    #customerEmail="ngModel"
                    required
                    email
                  />
                  <div *ngIf="reviewForm.submitted && customerEmail.invalid" class="text-danger">
                    Valid email is required.
                  </div>
                </div>

                </ng-container>

                <!-- 📸 Image Upload -->
                <div class="form-group">
                  <div class="d-flex align-items-center mb-2">
                    <button
                      type="button"
                      class="btn btn-outline-primary px-4 mr-3 text-dark"
                      (click)="triggerImageUpload()"
                    >
                      <i class="fa fa-upload mr-2"></i> Choose Images
                    </button>
                    <span class="text-muted">Upload Images (optional)</span>
                  </div>

                  <!-- Hidden input -->
                  <input
                    type="file"
                    #imageInput
                    id="imageUpload"
                    accept="image/*"
                    multiple
                    hidden
                    (change)="onImagesSelected($event)"
                  />

                  <!-- Image Previews -->
                  <div class="d-flex flex-wrap mt-2">
                    <div
                      *ngFor="let img of previewImages; let i = index"
                      class="position-relative mr-2 mb-2 rounded"
                      style="width: 80px; height: 80px; overflow: hidden;"
                    >
                    <img
                        [src]="img"
                        class="img-fluid h-100 w-100"
                        style="object-fit: cover;"
                      />
                      <button
                        type="button"
                        (click)="removeImage(i)"
                        class="btn btn-sm position-absolute d-flex align-items-center justify-content-center"
                        style="top: 2px; right: 2px; width: 22px; height: 22px; background-color: #dc3545; color: white; border-radius: 50%; font-weight: bold; font-size: 14px; line-height: 1; padding: 0; display: flex; align-items: center; justify-content: center;"
                        title="Remove"
                      >
                        ×
                      </button>

                    </div>
                  </div>

                </div>

              <div class="form-group mb-0">
                  <input type="submit" value="Leave Your Review" class="btn btn-primary px-3" />
              </div>
              </form>
            </div>



          </div>
        </div>
      </div>
    </div>
  </div>

</div>



<!-- 🚀 Ultra-Polished Toast -->
<div
  *ngIf="localToast.visible"
  class="toast show d-flex align-items-start shadow-lg animate__animated animate__fadeInDown"
  [ngClass]="{
    'border-success': localToast.type === 0,
    'border-warning': localToast.type === 1,
    'border-danger': localToast.type === 2,
    'bg-light': true
  }"
  style="
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1060;
    min-width: 320px;
    max-width: 400px;
    border-radius: 10px;
    padding: 14px 18px;
    border: 2px solid;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  ">

  <!-- Colored Vertical Accent -->
  <div
    class="position-absolute"
    [ngStyle]="{
      backgroundColor:
        localToast.type === 0 ? '#28a745' :
        localToast.type === 1 ? '#ffc107' :
        '#dc3545'
    }"
    style="top: 0; left: 0; height: 100%; width: 6px; border-top-left-radius: 8px; border-bottom-left-radius: 8px;"
  ></div>

  <!-- Icon -->
  <div class="mr-3 mt-1">
    <i
      class="fa"
      [ngClass]="{
        'fa-check-circle text-success': localToast.type === 0,
        'fa-exclamation-circle text-warning': localToast.type === 1,
        'fa-times-circle text-danger': localToast.type === 2
      }"
      style="font-size: 1.7rem;"
    ></i>
  </div>

  <!-- Message -->
  <div class="flex-fill">
    <div class="font-weight-bold mb-1" style="font-size: 16px; color: #222;">
      {{ localToast.type === 0 ? 'Success' : localToast.type === 1 ? 'Warning' : 'Error' }}
    </div>
    <div class="text-muted" style="font-size: 14px;">
      {{ localToast.message }}
    </div>
  </div>

  <!-- Close -->
  <button
    type="button"
    class="close ml-3 mt-1"
    (click)="localToast.visible = false"
    aria-label="Close"
    style="color: #666; font-size: 1.2rem;"
  >
    <span aria-hidden="true">&times;</span>
  </button>
</div>

